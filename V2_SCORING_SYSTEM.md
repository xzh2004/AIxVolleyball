# 🎯 V2评分系统完整说明

## 📊 V2评分标准（总分100分）

### **分项满分对比**

| 评分项 | V1满分 | V2满分 | 变化 | 说明 |
|--------|--------|--------|------|------|
| **手臂姿态** | 40分 | **35分** | -5分 | 降低权重，更合理 |
| **身体重心** | 30分 | **30分** | 不变 | 保持 |
| **触球位置** | 20分 | **25分** | +5分 | 提高权重，更重要 |
| **整体稳定** | 10分 | **10分** | 不变 | 保持 |
| **总分** | 100分 | **100分** | - | - |

---

## 🔍 详细评分标准

### **1. 手臂姿态（35分）**

#### **评分维度**：
- **左臂伸直度**（12分）：标准范围 150°-180°
- **右臂伸直度**（12分）：标准范围 150°-180°
- **双臂夹角**（11分）：标准范围 15°-45°

#### **评分特点**：
- 使用**柔性范围评分**：在范围内满分，略超出渐变扣分
- 根据身高自适应：高个子略宽松（145°-180°）

#### **示例**：
```
左臂角度：160° → 12/12分 ✅
右臂角度：155° → 12/12分 ✅
双臂夹角：30° → 11/11分 ✅
总分：35/35分
```

---

### **2. 身体重心（30分）**

#### **评分维度**：
- **左膝弯曲度**（12分）：标准范围 60°-120°
- **右膝弯曲度**（12分）：标准范围 60°-120°
- **双腿平衡性**（6分）：两腿角度差越小越好

#### **评分特点**：
- 自适应身高：矮个子可以蹲更低（55°-115°）
- 考虑对称性：双腿角度差<15°最佳

#### **示例**：
```
左膝角度：85° → 12/12分 ✅
右膝角度：90° → 12/12分 ✅
角度差：5° → 5.5/6分 ✅
总分：29.5/30分
```

---

### **3. 触球位置（25分）**

#### **评分维度**：
- **相对位置评分**（15分）：手腕在肩-膝之间的相对位置
- **高度评分**（10分）：手腕相对于髋部的高度

#### **评分特点**：
- **多参考点**：同时参考肩、髋、膝的位置
- **考虑身高**：相对于身高计算，更公平
- **前后位置**：检查手臂是否前伸

#### **理想位置**：
```
手腕应在：髋部 ≤ 手腕 ≤ 膝盖
手腕位置：略低于髋部（腰腹前下方）
```

#### **示例**：
```
相对位置：0.8（肩膝之间偏下） → 15/15分 ✅
高度评分：略低于髋部 → 10/10分 ✅
总分：25/25分
```

---

### **4. 整体稳定性（10分）**

#### **评分依据**：
- MediaPipe检测的关键点**可见度/置信度**
- 10个关键点的平均可见度

#### **评分标准**：
```
可见度 > 0.75：✅ 姿态识别清晰（8-10分）
可见度 0.5-0.75：⚠️ 姿态识别一般（5-8分）
可见度 < 0.5：❌ 姿态识别不清晰（0-5分）
```

#### **示例**：
```
平均可见度：0.85 → 8.5/10分 ✅
```

---

## 🎨 前端显示

### **分项得分卡片**

```
📊 分项得分

手臂姿态          触球位置
33.1/35          25.0/25

身体重心          整体稳定
28.2/30           6.8/10
```

### **雷达图**

百分比计算：
- 手臂姿态：(33.1 / 35) × 100 = 94.6%
- 触球位置：(25.0 / 25) × 100 = 100%
- 身体重心：(28.2 / 30) × 100 = 94.0%
- 整体稳定：(6.8 / 10) × 100 = 68.0%

---

## 🔒 分数保护机制

### **上限保护**

为防止计算异常导致分数溢出，所有分项都有**硬上限保护**：

```python
# 手臂评分
total_arm_score = min(35, left_score + right_score + gap_score)

# 身体评分
total_body_score = min(30, left_knee_score + right_knee_score + balance_score)

# 触球位置
total_position_score = min(25, position_score_1 + height_score)

# 稳定性
stability_score = min(10, avg_visibility * 10)
```

### **效果**

即使计算错误，分数也不会超过上限：
- ❌ 38分 → ✅ 35分（手臂）
- ❌ 27分 → ✅ 25分（触球）
- ❌ 105分 → ✅ 100分（总分）

---

## 🏆 等级评定

### **V2等级标准**（更宽松）

| 等级 | 分数范围 | 评价 | 表情 |
|------|----------|------|------|
| **S级** | ≥85分 | 完美！职业级水准！ | 🏆 |
| **A级** | 75-84分 | 优秀！继续保持！ | ⭐ |
| **B级** | 65-74分 | 良好！再接再厉！ | 👍 |
| **C级** | 55-64分 | 及格！继续努力！ | 💪 |
| **D级** | <55分 | 需要改进！多多练习！ | 📚 |

### **对比V1**

| 等级 | V1标准 | V2标准 | 差异 |
|------|--------|--------|------|
| S级 | ≥90分 | ≥85分 | -5分 |
| A级 | ≥80分 | ≥75分 | -5分 |
| B级 | ≥70分 | ≥65分 | -5分 |
| C级 | ≥60分 | ≥55分 | -5分 |

---

## 📈 V2的核心改进

### **1. 更科学的评分标准**
- ✅ 范围评分代替固定值
- ✅ 柔性评分曲线
- ✅ 自适应身高标准

### **2. 更合理的权重分配**
- ✅ 手臂：40→35分（降低）
- ✅ 触球位置：20→25分（提高）
- ✅ 更符合实际重要性

### **3. 更友好的反馈**
- ✅ 详细到每个部位
- ✅ 鼓励性建议
- ✅ 具体改进方向

### **4. 更可靠的保护**
- ✅ 分数上限保护
- ✅ 异常数据处理
- ✅ 防止分数溢出

---

## 🎯 实际评分示例

### **优秀动作（S级）**

```
总分：88分 🏆

手臂姿态：33.5/35 (95.7%)
  ✅ 左臂姿势很好（165°）
  ✅ 右臂姿势很好（170°）
  ✅ 双臂间距标准（28°）

身体重心：28.5/30 (95.0%)
  ✅ 左腿弯曲适中（80°）
  ✅ 右腿弯曲适中（85°）
  ✅ 双腿平衡稳定（差5°）

触球位置：23.0/25 (92.0%)
  ✅ 触球位置标准（腰腹前下方）
  ✅ 手臂前伸位置合适

整体稳定：9.0/10 (90.0%)
  ✅ 姿态识别清晰
```

---

### **良好动作（B级）**

```
总分：68分 👍

手臂姿态：28.0/35 (80.0%)
  ⚠️ 左臂可以更伸直一些（148°）
  ✅ 右臂姿势很好（165°）
  ⚠️ 双臂可以稍微打开一些（12°）

身体重心：25.0/30 (83.3%)
  ✅ 左腿弯曲适中（75°）
  ⚠️ 右腿略直（135°）
  ⚠️ 注意双腿平衡

触球位置：18.0/25 (72.0%)
  ⚠️ 触球位置略有偏差
  ✅ 手臂前伸位置合适

整体稳定：7.0/10 (70.0%)
  ⚠️ 姿态识别一般，建议改善拍摄角度
```

---

## 🔄 序列分析（连续帧深度分析）

### **综合评分公式**

```python
总分 = 最佳帧得分 × 0.6 + (流畅度 × 100) × 0.25 + (完整性 × 100) × 0.15
```

### **示例计算**

```
最佳帧：85分
流畅度：0.80 (80%)
完整性：0.90 (90%)

总分 = 85 × 0.6 + 80 × 0.25 + 90 × 0.15
     = 51 + 20 + 13.5
     = 84.5分 → 85分（A级）
```

### **反馈结构**

```
【最佳帧动作分析】
✅ 左臂姿势很好
✅ 右臂姿势很好
✅ 双臂间距标准
⚠️ 左腿可以弯曲一些
✅ 触球位置标准
✅ 姿态识别清晰

【动作连贯性分析】
✅ 动作流畅自然
✅ 动作完整规范
```

---

## 📝 技术实现

### **核心文件**

- `backend/core/scorer_v2.py` - V2评分器
- `backend/services/volleyball_service.py` - 服务层集成
- `frontend/components/score_card.py` - 前端显示

### **关键方法**

```python
# 单帧评分
score_result = scorer.score_pose(landmarks)

# 序列评分（新增）
sequence_result = scorer.score_sequence(landmarks_sequence)

# 自适应标准
standards = scorer.get_adaptive_standards(body_height)

# 柔性评分
score = scorer._soft_range_score(value, min_val, max_val, max_score)
```

---

## ✅ 已修复的Bug

1. ✅ 序列分析缺少详细反馈
2. ✅ 分项得分显示为0
3. ✅ 分数计算逻辑优化
4. ✅ 前端满分值不匹配
5. ✅ 分数上限保护缺失

---

## 🚀 使用建议

### **单帧快速分析**
- 适合：静态姿势评估
- 只看：姿态标准度
- 速度：快

### **连续帧深度分析**
- 适合：完整动作评估
- 综合：姿态+流畅度+完整性
- 速度：慢但全面

---

**版本**: V2.1  
**状态**: ✅ 生产可用  
**最后更新**: 2025-11-01


